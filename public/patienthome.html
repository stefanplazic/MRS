<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Home page</title>
    <script>
        checkIfLogged();
        $(document).ready(function () {
            init();
            getPatienProfile();
        });
        function init() {
            hideError();
        }
        async function getPatienProfile() {
            const jwt = JSON.parse(localStorage.getItem('userData')).jwt;
            const url = window.location.origin + '/patients/profileData';
            fetch(url, { method: 'GET', mode: 'cors', headers: { 'Content-Type': 'application/json', 'authorization': jwt }, })
                .then(function (result) {
                    return result.json();
                })
                .then(function (result) {
                    if (!result.success) {
                        showError(result.message);
                        return;
                    }
                    hideError();
                    window.profileData = result.userData;
                    setProfileForm();
                })
                .catch(function (err) {
                    console.error(err);
                });
        }

        //function for puting values inside profile form
        function setProfileForm() {
            const user = window.profileData.user;
            const location = window.profileData.location;
            const patientData = window.profileData.patientdata;

            $('#inputFN').val(user.fName);
            $('#inputLN').val(user.lName);
            $('#inputEmail').val(user.email);
            $('#inputPassword').val(user.password);
            $('#inputRepeat').val(user.password);
            $('#inputAddress').val(location.address);
            $('#inputCity').val(location.city);
            $('#inputState').val(location.state);
            $('#inputNum').val(patientData.phone);
            $('#inputPhone').val(patientData.identification_number);
        }

        function showError(error) {
            $('#errorAlert').text(error).show();
        }

        function hideError() {
            $("#errorAlert").hide();
        }

        function checkIfLogged() {
            const userData = localStorage.getItem('userData', false);
            redirect(JSON.parse(userData));

        }

        function redirect(userData) {
            if ((userData != false) && userData.role != 'patient') {
                window.location.href = '/';
                return;
            }
        }
    </script>
</head>

<body>
    <div class="container">
        <h3 class="text-center">Patient Home page</h3>
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="#home">Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#menu1">Search doctors</a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div id="home" class="container tab-pane active"><br>
                <h3>Update your profile</h3>
                <form id="formId">

                    <div class="form-group">
                        <label for="inputFN">First name</label>
                        <input type="text" class="form-control" required minlength="4" id="inputFN"
                            placeholder="Enter first name">

                    </div>
                    <div class="form-group">
                        <label for="inputLN">Last name</label>
                        <input type="text" class="form-control" class="form-control" required minlength="4" id="inputLN"
                            placeholder="Enter last name">

                    </div>
                    <div class="form-group">
                        <label for="inputEmail">Email address</label>
                        <input type="email" readonly required class="form-control" id="inputEmail"
                            aria-describedby="emailHelp" placeholder="Enter email">

                    </div>
                    <div class="form-group">
                        <label for="inputAddress">Address</label>
                        <input type="text" class="form-control" class="form-control" required minlength="8"
                            class="form-control" required minlength="8" id="inputAddress" placeholder="Enter address">

                    </div>
                    <div class="form-group">
                        <label for="inputCity">City</label>
                        <input type="text" class="form-control" class="form-control" required minlength="2"
                            id="inputCity" placeholder="Enter city">

                    </div>
                    <div class="form-group">
                        <label for="inputState">State</label>
                        <input type="text" class="form-control" class="form-control" required minlength="4"
                            id="inputState" placeholder="Enter state">

                    </div>

                    <div class="form-group">
                        <label for="inputPhone">Phone</label>
                        <input type="text" class="form-control" class="form-control" required minlength="8"
                            id="inputPhone" placeholder="Enter phone">

                    </div>

                    <div class="form-group">
                        <label for="inputNum">Identification Number</label>
                        <input type="text" readonly class="form-control" class="form-control" required minlength="8"
                            id="inputNum" placeholder="Enter number">

                    </div>

                    <div class="form-group">
                        <label for="inputPassword">Password</label>
                        <input type="password" class="form-control" class="form-control" required minlength="4"
                            id="inputPassword" placeholder="Password">
                    </div>
                    <div class="form-group">
                        <label for="inputRepeat">Repeat Password</label>
                        <input type="password" class="form-control" class="form-control" required minlength="4"
                            id="inputRepeat" placeholder="Repeat Password">
                    </div>
                    <div class="alert alert-danger alert-dismissible" id="errorAlert">
                        Error text
                    </div>
                    <button type="button" class="btn btn-primary" onclick="">Update profile data</button>
                </form>
            </div>

            <!--SEARCH DOCTORS-->
            <div id="menu1" class="container tab-pane fade"><br>
                <h3>Menu 1</h3>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                    consequat.</p>
            </div>

        </div>
    </div>
    <script>
        $(document).ready(function () {
            $(".nav-tabs a").click(function () {
                $(this).tab('show');
            });
        });
    </script>
</body>

</html>